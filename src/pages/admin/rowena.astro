---
import { db, like, User } from "astro:db";
import qrcode from 'qrcode';
import MainLayout from '../../layouts/MainLayout.astro'

const { user, session } = Astro.locals;
if (session == null) {
  return Astro.redirect("/admin/signin");
} else {
  console.log( session);
}

const qrUser = await db.select().from(User).where(like(User.id, session.userId));
console.log(qrUser)

let qrImageUrl = '';
qrImageUrl = qrUser[0].qr == '' ? null : await qrcode.toDataURL(qrUser[0].qr);
---
<MainLayout w_header>

  <div class="bg-white p-6 rounded-lg shadow-lg max-w-md mx-auto my-20">
    <h1 class="text-2xl font-bold mb-4">{qrUser[0].username}</h1>
    <p class="text-gray-700 mb-6">¡Bienvenido! Aquí puedes escanear el código QR para conectar tu WhatsApp al bot.</p>
    {qrImageUrl ? (
      <img src={qrImageUrl} alt="QR Code" class="mx-auto w-1/2 h-1/2" />
    ) : (
      <p class="text-red-500">No QR code available</p>
    )}
</div>
</MainLayout>
